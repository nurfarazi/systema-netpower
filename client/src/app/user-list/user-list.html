<div class="user-list-container">
  <h1>Users</h1>

  <div class="filters-container">
    <input
      id="search-input"
      type="text"
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchChange($event)"
      placeholder="Search by name or email..."
      class="search-input"
    />

    <select
      id="status-filter"
      [(ngModel)]="isActiveFilter"
      (ngModelChange)="onIsActiveFilterChange()"
      class="status-filter"
    >
      <option value="all">All Users</option>
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
    </select>

    @if (searchTerm !== '' || isActiveFilter !== 'all') {
      <button
        class="clear-filters-btn"
        (click)="clearFilters()"
      >
        Clear Filters
      </button>
    }
  </div>

  @if (loading$ | async) {
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Loading users...</p>
    </div>
  } @else if (users$ | async; as users) {
    @if (users.length > 0) {
      <table class="users-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Status</th>
            <th>Created By</th>
            <th>Created At</th>
          </tr>
        </thead>
        <tbody>
          @for (user of users; track trackByUserId($index, user)) {
            <tr [class.inactive]="!user.isActive">
              <td class="name">{{ user.name }}</td>
              <td class="email">{{ user.email }}</td>
              <td class="status">
                <span class="status-badge" [class.active]="user.isActive">
                  {{ user.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td class="created-by">{{ user.createdBy }}</td>
              <td class="created-at">{{ user.createdAt | date: 'short' }}</td>
            </tr>
          }
        </tbody>
      </table>

      @if (totalCount$ | async; as totalCount) {
        <div class="pagination-container">
          <div class="pagination-info">
            <span>Showing {{ getStartItem(totalCount) }} - {{ getEndItem(totalCount) }} of {{ totalCount }} users</span>
          </div>

          <div class="pagination-controls">
            <select
              [(ngModel)]="pageSize"
              (ngModelChange)="onPageSizeChange($event)"
              class="page-size-selector"
            >
              @for (size of pageSizeOptions; track size) {
                <option [value]="size">{{ size }} per page</option>
              }
            </select>

            <div class="page-navigation">
              <button
                class="page-btn"
                (click)="prevPage()"
                [disabled]="currentPage === 1"
              >
                Previous
              </button>

              <span class="page-info">Page {{ currentPage }} of {{ getTotalPages(totalCount) }}</span>

              <button
                class="page-btn"
                (click)="nextPage(totalCount)"
                [disabled]="currentPage === getTotalPages(totalCount) || getTotalPages(totalCount) === 0"
              >
                Next
              </button>
            </div>
          </div>
        </div>
      }
    } @else {
      <div class="empty-state">
        <p>No users found</p>
      </div>
    }
  }
</div>
